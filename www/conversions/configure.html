<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Configurable Attribution</title>
  <meta http-equiv="origin-trial" content="AhLiKoJIb0AwsL4F4D36xJ7UmaUc/85N1Yk5yjDLxPAoI/TTSQ2jDYaPXeGhU4dt3Kp1doeVRZkbVzEiIsVQcQMAAABdeyJvcmlnaW4iOiJodHRwczovL2NyLmt1bmdmb28ubmV0OjQ0MyIsImZlYXR1cmUiOiJDb252ZXJzaW9uTWVhc3VyZW1lbnQiLCJleHBpcnkiOjE2MjYyMjA3OTl9">
</head>
<body>
  <form>
    <fieldset>
      <legend>Source</legend>
      <label>Event ID: <input name="sourceeventid" type="number"></label>
      <br>
      <label>Priority: <input name="sourcepriority" type="number" value="0"></label>
    </fieldset>
    <fieldset>
      <legend>Trigger</legend>
      <label>Trigger Data: <input type="number" name="triggerdata" value="1"></label>
      <br>
      <label>Event-Source Trigger Data: <input type="number" name="eventsourcetriggerdata" value="2"></label>
      <br>
      <label>Priority: <input type="number" name="triggerpriority" value="0"></label>
    </fieldset>
    <button id="add-anchor" type="button">Add Anchor</button>
  </form>
  <ol id="anchors"></ol>
</body>
<script>
  const form = document.forms[0];

  const vals = new Uint32Array(1);
  window.crypto.getRandomValues(vals);
  form.sourceeventid.value = vals[0];

  document.getElementById('add-anchor').addEventListener('click', (e) => {
    const params = {
      'sourceeventid': form.sourceeventid.value,
      'sourcepriority': form.sourcepriority.value,
      'triggerdata': form.triggerdata.value,
      'eventsourcetriggerdata': form.eventsourcetriggerdata.value,
      'triggerpriority': form.triggerpriority.value,
    };

    const triggerParams = new URLSearchParams();
    triggerParams.set('trigger-data', params.triggerdata);
    triggerParams.set('event-source-trigger-data', params.eventsourcetriggerdata);
    triggerParams.set('priority', params.triggerpriority);

    const a = document.createElement('a');
    a.target = '_blank';
    a.href = 'https://cr.kungfoo.net/conversions/configure_convert.php?' + triggerParams.toString();
    a.rel = 'opener';
    a.innerText = JSON.stringify(params);

    a.setAttribute('attributionsourceeventid',  params.sourceeventid);
    a.setAttribute('attributionsourcepriority', params.sourcepriority);
    a.setAttribute('attributiondestination', 'https://cr.kungfoo.net');

    const li = document.createElement('li');
    li.appendChild(a);
    document.getElementById('anchors').appendChild(li);
  });
</script>
</html>
