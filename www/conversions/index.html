<html>
<head>
  <title> Conversions test </title>
</head>
<body>
  <h2> Test page for stuff </h2>
  <p id="abc"></p>
</body>
<script>
  let meta = document.createElement("meta");
  meta.httpEquiv = "origin-trial";
  meta.content = "AhLiKoJIb0AwsL4F4D36xJ7UmaUc/85N1Yk5yjDLxPAoI/TTSQ2jDYaPXeGhU4dt3Kp1doeVRZkbVzEiIsVQcQMAAABdeyJvcmlnaW4iOiJodHRwczovL2NyLmt1bmdmb28ubmV0OjQ0MyIsImZlYXR1cmUiOiJDb252ZXJzaW9uTWVhc3VyZW1lbnQiLCJleHBpcnkiOjE2MjYyMjA3OTl9";
  document.getElementsByTagName('head')[0].appendChild(meta);
  
  let p = document.getElementById("abc");
  if (document.featurePolicy.allowsFeature("attribution-reporting")) {
    p.innerText = "policy available";
  } else {
    p.innerText = "policy NOT available"; 
  }
  console.log(document.featurePolicy.features());
  
  var adLink = document.createElement("a");
  adLink.target = "_blank";
  adLink.href = "https://cr2.kungfoo.net/conversions/target.html";
  adLink.innerText = "Click me";
  adLink.rel = "opener";

  // Come up with a random 64 bit hex number for the id.
  var randomNums = new Uint32Array(2);
  window.crypto.getRandomValues(randomNums);

  // TODO: This should move away from setAttribute (crbug.com/1097144)
  adLink.setAttribute("attributionsourceeventid",  randomNums[0].toString(10) + randomNums[1].toString(10));
  adLink.setAttribute("attributiondestination", "https://cr2.kungfoo.net");

  document.body.appendChild(adLink);
  
  var adLink = document.createElement("a");
  adLink.target = "_blank";
  adLink.href = "https://cr2.kungfoo.net/conversions/target.html";
  adLink.innerText = "No opener link";

  // Come up with a random 64 bit hex number for the id.
  var randomNums = new Uint32Array(2);
  window.crypto.getRandomValues(randomNums);

  // TODO: This should move away from setAttribute (crbug.com/1097144)
  adLink.setAttribute("attributionsourceeventid",  randomNums[0].toString(10) + randomNums[1].toString(10));
  adLink.setAttribute("attributiondestination", "https://cr2.kungfoo.net");

  document.body.appendChild(adLink);
</script>
</html>
