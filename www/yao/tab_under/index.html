<!DOCTYPE html>
<p>This site opens a popup and navigates this page automatically to a cross origin site.
You can choose if you want to open the popup first, or navigate first.
<br>
<button onclick='windowOpenAndNavigate()'>Popup and then navigate!</button>
<br>
<button onclick='navigateAndWindowOpen()'>Navigate and then Popup!</button>
<br>
<button onclick='ctrlNavigateAndWindowOpen()'>Simulate Ctrl Navigate and then Popup!</button>
<br>
<button onclick='metaNavigateAndWindowOpen()'>Simulate Meta Navigate and then Popup!</button>
<br>
<button onclick='shiftNavigateAndWindowOpen()'>Simulate Shift Navigate and then Popup!</button>
<br>

<a href="https://google.com">site with no engagemenet</a>
<a href="/">Home</a>
<a id="dispatcher" href="/">Home and dispatch a window.open in setTimeout</a>
<script>
function navigateAndWindowOpen() {
  document.getElementsByTagName('a')[0].click();
  window.open(location.href);
}

function windowOpenAndNavigate() {
  var opened = !!window.open(location.href);
  document.getElementsByTagName('a')[0].click();
}

function ctrlNavigateAndWindowOpen() {
  var evt = new MouseEvent('click', {
    view : window,
    ctrlKey: true
  });
  document.getElementsByTagName('a')[0].dispatchEvent(evt);
  window.open(location.href);
}
function metaNavigateAndWindowOpen() {
  var evt = new MouseEvent('click', {
    view : window,
    metaKey: true
  });
  document.getElementsByTagName('a')[0].dispatchEvent(evt);
  window.open(location.href);
}
function shiftNavigateAndWindowOpen() {
  var evt = new MouseEvent('click', {
    view : window,
    shiftKey: true
  });
  document.getElementsByTagName('a')[0].dispatchEvent(evt);
  window.open(location.href);
}

document.getElementById("dispatcher").addEventListener("click", (e) => {
  setTimeout(() => window.open("/"), 0);
});

</script>
